# üìä –õ–û–ì–ò–ö–ê –°–ë–û–†–ê –î–ê–ù–ù–´–• ORDERBOOK

## üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã **24/7 —Å–±–æ—Ä–∞ —Ç–∏–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö** —Å –∫–Ω–∏–≥–∏ –ø–æ–∫—É–ø–æ–∫/–ø—Ä–æ–¥–∞–∂ (orderbook) –±–∏—Ä–∂–∏ Binance –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–µ–π –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

## üèóÔ∏è 3-—Ñ–∞–∑–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Phase 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Real-time Collection)
**–¶–µ–ª—å:** –ü–æ–ª—É—á–µ–Ω–∏–µ –†–ï–ê–õ–¨–ù–´–• –¥–∞–Ω–Ω—ã—Ö orderbook –æ—Ç Binance –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `BinanceCollector` ‚Äî WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Binance
- `OrderBookProcessor` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–Ω–∏–º–∫–æ–≤ orderbook  
- `DataValidator` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- WebSocket –∫ Binance API
- JSON orderbook snapshots –∏ updates
- –¢–∏–∫–æ–≤–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–≤—Å—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ orderbook)
- Rate Limit –∑–∞—â–∏—Ç–∞

### Phase 2: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ (Data Accumulation)
**–¶–µ–ª—å:** –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `DataCompressor` ‚Äî —Å–∂–∞—Ç–∏–µ –∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- `StorageManager` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `FileRotator` ‚Äî —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Gzip —Å–∂–∞—Ç–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (24 —á–∞—Å–∞)
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### Phase 3: –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (ML Export)
**–¶–µ–ª—å:** –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ML

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `CSVExporter` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤ CSV —Ñ–æ—Ä–º–∞—Ç
- `ParquetExporter` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤ Parquet —Ñ–æ—Ä–º–∞—Ç
- `DataFormatter` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è ML pipeline

## üìä –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –í—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ (WebSocket)
```json
{
  "e": "depthUpdate",
  "E": 1751328000003,
  "s": "BTCUSDT", 
  "U": 123456789,
  "u": 123456790,
  "b": [["43250.50", "0.75"]],
  "a": [["43251.00", "1.25"]]
}
```

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (CSV)
```csv
exchange,symbol,timestamp,local_timestamp,ask_amount,ask_price,bid_price,bid_amount
binance-futures,BTCUSDT,1751328000003000,1751328000007356,1.25,43251.00,43250.50,0.75
```

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Binance API ‚Üí WebSocket ‚Üí OrderBookProcessor ‚Üí DataValidator
     ‚Üì
StorageManager ‚Üí DataCompressor ‚Üí FileRotator
     ‚Üì  
CSVExporter ‚Üí ML Pipeline
```

## üõ°Ô∏è –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª—å–Ω—ã–µ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Binance API
- Read-only –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å orderbook –¥–∞–Ω–Ω—ã–º–∏
- –°–∂–∞—Ç–∏–µ –∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –≠–∫—Å–ø–æ—Ä—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (CSV, Parquet)

### ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- Mock, —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ, random –∏–ª–∏ —Ñ–∞–π–ª–æ–≤—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –¢–æ—Ä–≥–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –ª—é–±—ã–µ write –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏–ª–∏ API –∫–ª—é—á–µ–π

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- **Latency:** –≤—Ä–µ–º—è –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ –∑–∞–ø–∏—Å–∏
- **Throughput:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Å–µ–∫—É–Ω–¥—É
- **Storage:** –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ
- **Uptime:** –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Å–±–æ–µ–≤

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `HealthMonitor` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- `MetricsCollector` ‚Äî —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `WebDashboard` ‚Äî –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```json
{
  "symbols": ["BTCUSDT", "ETHUSDT", "SOLUSDT"],
  "websocket": {
    "url": "wss://fstream.binance.com/ws/",
    "reconnect_interval": 5,
    "ping_interval": 20
  },
  "storage": {
    "base_dir": "/data/binance_orderbook",
    "compression": "gzip",
    "rotation_hours": 24,
    "backup_enabled": true
  },
  "monitoring": {
    "web_port": 8080,
    "metrics_interval": 60,
    "health_check_interval": 30
  }
}
```

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
```bash
python -m collector.main --symbol BTCUSDT --output-dir /path/to/storage
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
- `--symbol` ‚Äî —Ç–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ (BTCUSDT, ETHUSDT, SOLUSDT)
- `--output-dir` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- `--config` ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `--compress` ‚Äî –≤–∫–ª—é—á–∏—Ç—å —Å–∂–∞—Ç–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
- `--monitor` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ–±-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- `--verbose` ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **RAM:** 1 –ì–ë
- **Disk:** 50 –ì–ë/–º–µ—Å—è—Ü –Ω–∞ —Å–∏–º–≤–æ–ª
- **Network:** —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (5+ –ú–±–∏—Ç/—Å)
- **Python:** 3.8+

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **RAM:** 2+ –ì–ë
- **Disk:** 100+ –ì–ë/–º–µ—Å—è—Ü –Ω–∞ —Å–∏–º–≤–æ–ª
- **Network:** –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª (10+ –ú–±–∏—Ç/—Å)
- **Backup:** –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç
```bash
python -m collector.main --symbol BTCUSDT --test-mode
```

### Unit —Ç–µ—Å—Ç—ã
```bash
python -m pytest tests/test_binance_collector.py
python -m pytest tests/test_orderbook_processor.py
python -m pytest tests/test_data_manager.py
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
python -m pytest tests/test_full_pipeline.py
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
collector/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ websocket/              # WebSocket –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ binance_collector.py
‚îÇ   ‚îú‚îÄ‚îÄ connection_manager.py
‚îÇ   ‚îî‚îÄ‚îÄ rate_limiter.py
‚îú‚îÄ‚îÄ processing/             # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ orderbook_processor.py
‚îÇ   ‚îú‚îÄ‚îÄ data_validator.py
‚îÇ   ‚îî‚îÄ‚îÄ data_formatter.py
‚îú‚îÄ‚îÄ storage/                # –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ data_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ compressor.py
‚îÇ   ‚îî‚îÄ‚îÄ file_rotator.py
‚îú‚îÄ‚îÄ export/                 # –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ csv_exporter.py
‚îÇ   ‚îú‚îÄ‚îÄ parquet_exporter.py
‚îÇ   ‚îî‚îÄ‚îÄ ml_formatter.py
‚îú‚îÄ‚îÄ monitor/                # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ health_checker.py
‚îÇ   ‚îú‚îÄ‚îÄ metrics_collector.py
‚îÇ   ‚îî‚îÄ‚îÄ web_dashboard.py
‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ settings.json
‚îÇ   ‚îî‚îÄ‚îÄ logging.yaml
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ api_spec.md
‚îÇ   ‚îú‚îÄ‚îÄ server_integration.md
‚îÇ   ‚îî‚îÄ‚îÄ deployment_guide.md
‚îî‚îÄ‚îÄ tests/                  # –¢–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ test_binance_collector.py
    ‚îú‚îÄ‚îÄ test_orderbook_processor.py
    ‚îî‚îÄ‚îÄ test_full_pipeline.py
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** ‚Äî –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock –∏–ª–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ main.py** ‚Äî –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –∏–ª–∏ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
3. **–í—Å–µ –ø—É—Ç–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º collector/** ‚Äî —Å—Ç—Ä–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞
4. **API Binance —Ç–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
- `collector/logs/collector.log` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥
- `collector/logs/websocket.log` ‚Äî –ª–æ–≥–∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `collector/logs/error.log` ‚Äî –æ—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫
2. **–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∏—Å–∫–∞** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
3. **Rate Limit** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
4. **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å–∏–º–≤–æ–ª–∞–º

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 20 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ